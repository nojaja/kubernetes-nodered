const fs = require("fs");
const path = require("path");
const ip = require("ip");
const os = require("os");

module.exports = function (RED) {
    RED.util.getLocalAddress = () => {
        const ifacesObj = {}
        ifacesObj.ipv4 = []
        ifacesObj.ipv6 = []
        const interfaces = os.networkInterfaces()
        for (let ifname in interfaces) {
            interfaces[ifname].forEach(function (iface) {
                if (!iface.internal) {
                    const broadcastAddress = ip.or(iface.address, ip.not(iface.netmask))
                    switch (iface.family) {
                        case "IPv4":
                            ifacesObj.ipv4.push({ name: ifname, address: iface.address, broadcastAddress: broadcastAddress })
                            break
                        case "IPv6":
                            ifacesObj.ipv6.push({ name: ifname, address: iface.address, broadcastAddress: broadcastAddress })
                            break
                    }
                }
            });
        }
        return ifacesObj;
    };

}